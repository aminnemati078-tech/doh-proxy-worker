name: Obfuscate worker.js

on:
  push:
    branches: [ main ]

jobs:
  obfuscate:
    runs-on: ubuntu-latest

    steps:

    - name: Checkout
      uses: actions/checkout@v4

    - name: Install javascript-obfuscator
      run: npm install -g javascript-obfuscator

    - name: Obfuscate worker.js
      run: |
        mkdir -p dist
        javascript-obfuscator worker.js \
        --output dist/worker.js \
        --compact true \
        --control-flow-flattening true \
        --control-flow-flattening-threshold 1 \
        --dead-code-injection true \
        --dead-code-injection-threshold 1 \
        --debug-protection true \
        --debug-protection-interval true \
        --disable-console-output true \
        --identifier-names-generator hexadecimal \
        --rename-globals true \
        --self-defending true \
        --string-array true \
        --string-array-encoding base64 \
        --string-array-threshold 1 \
        --transform-object-keys true \
        --unicode-escape-sequence true
